# 상포배제 기법

- 공유자원을 안젠하게 관리하려면 상호 배제 기법이 필요하다. 세마포어(Semaphore)와 뮤텍스(Mutex)는 모두 이 상호 배제 기법 중 하나이다.

## 뮤텍스 Mutex

- 공유자원에 접근하기 위해 필요한 오브젝트가 있고, 이 오브젝트를 소유한 쓰레드/프로세스만 공유자원이 접근할 수 있다.

### 예시

- 화장실이 하나 있는 식당이 있다고 할 때, 카운터에서 하나뿐인 열쇠를 가져간 사람만이 화장실이 이용 가능한 경우와 같다.
- 카운터에 키가 없으면 화장실에 사람이 있다는 뜻일 것. 키를 돌려놓으면 대기자가 순서에 맞게 화장실을 이용 가능하다.
  => 화장실 === 공유자원, 사람들 === 프로세스 / 쓰레드, 키 === 오브젝트

### 특징

- 뮤텍스 객체를 두 스레드가 동시 사용 불가
  ![](https://velog.velcdn.com/images/urjimyu/post/cbdd3a20-e054-49bc-a921-0c119e838ac5/image.png)

## 세마포어 Semaphore

- 공유자원을 공통으로 관리하는 값 하나를 이용해서 상호 배제를 달성한다.

### 예시

- 화장실이 여러 개 있고 화장실 입구에 현재 화장실 빈 칸 개수를 보여주는 전광판이 있는 식당의 경우와 비슷하다.
- 전광판 숫자를 보고 0이 되면 기다리고, 0보다 크면 화장실을 이용 가능하다.
  => 화장실 === 공유자원, 사람들 === 쓰레드/프로세스, 전광판 숫자 === 공유자원 관리하는 값

### 특징

- 공유 자원에 접근할 수 있는 프로세스의 최대 허용치만큼 동시에 사용자가 접근 가능
- 각 프로세스가 세마포어 값을 확인/변경 가능
  ![](https://velog.velcdn.com/images/urjimyu/post/727f183b-14c8-4620-b604-0262dcc01383/image.png)

## 차이점

1. 동기화 대상의 개수

- Mutex: 동기화 대상 1개일 때 사용
- Semaphore: 동기화 대상이 1개 이상일 때 사용

2. 세마포어는 뮤텍스가 될 수 있지만 뮤텍스는 세마포어가 될 수 없다.

- Mutext: 0,1로 이루어진 이진 상태(Binary Semaphore)

3. 자원 소유가능 여부

- Mutex: 자원 소유가능 + 책임
- Semaphore: 자원 소유 불가

4. 해제 가능한 주체

- Mutex: 소유하고 있는 스레드만 Mutex 해제 가능
- Semaphore: Semaphore를 소유하지 않는 스레드도 해제 가능

5. 범위 차이

- Semaphore: 시스템 범위. 파일 시스템 상의 파일로 존재.
- Mutex: 프로세스 범위. 프로세스 종료 시 자동 Clean up

### 한계

뮤텍스와 세마포어 모두 완벽한 데이터 무결성을 보장하지 않으며, 데드락 발생 가능성이 여전히 있다

---

### References

[뮤텍스(Mutex)와 세마포어(Semaphore)의 차이](https://medium.com/@kwoncharles/%EB%AE%A4%ED%85%8D%EC%8A%A4-mutex-%EC%99%80-%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4-semaphore-%EC%9D%98-%EC%B0%A8%EC%9D%B4-de6078d3c453)
[뮤텍스(Mutex)와 세마포어(Semaphore)의 차이](https://velog.io/@heetaeheo/%EB%AE%A4%ED%85%8D%EC%8A%A4Mutex%EC%99%80-%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4Semaphore%EC%9D%98-%EC%B0%A8%EC%9D%B4)
